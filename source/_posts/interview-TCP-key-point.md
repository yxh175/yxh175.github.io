---
title: 面试重点知识点：TCP相关
date: 2023-09-21 11:24:42
categories:
- 八股文
tags:
- 计算机网络
- TCP
---

本文主要参考[小林coding](https://xiaolincoding.com/network/3_tcp/tcp_interview.html#tcp-%E5%A4%B4%E6%A0%BC%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B)

## TCP 基本认识

### TCP头格式有哪些？

说几个重点的

- seq 序列号：解决网络包乱序问题
- 确认应答号：解决丢包问题
- 控制位：表示状态
    1. ACK：确认应答
    2. SYN：建立连接
    3. RST：异常断开
    4. FIN: 正常结束

### TCP工作了哪一层？为什么这么多应用层都用它？

TCP工作在传输层，为应用层服务。
大多数应用层都用它的原因是因为IP层只保证两点之间的连接，但是无法保证整个报文的正常交付，所以需要提升一个层面去监督IP的传输过程。保证传输的可靠性

### TCP是什么？

一种传输协议，它有以下三个特点

- 面向连接： 一对一连接
- 可靠的： 保证报文的正常交互
- 基于字节流的： 字节流传输，可能会出现粘包的问题

### 什么是TCP连接？

TCP 连接简单来说就是用于保证可靠性和流量控制的一些状态，总共有三个

- socket： 保证两个主机之间能够连接
- 序列号： 保证了不会乱序
- 窗口大小： 实现流量控制

### 如何确定一个TCP连接？

通过四元组

（源地址，源端口，目的地址，目的端口）

#### TCP理论的最大连接数？

理论最大连接数 = 客户端IP数*服务端端口数

但是系统的最大并发数是有限制的

- 在linux系统中一个TCP连接算一个文件，会导致文件描述符（Linux指向文件的指针表）被占满
- 内存会OOM

### UDP和TCP 的区别？ 场景的区别？

TCP 和UDP的区别主要有七个点

- 有无连接： TCP是有连接， UDP无连接
- 可靠性： TCP保证报文的交付，UDP不保证
- 连接数： TCP是1对1， UDP是可以1对1或者1对多的
- 拥塞控制、流量控制： TCP有这些，UDP无法感知对方的接收（QUIC除外）
- 首部开销： TCP 首部有端口、序列号、状态码， UDP 只有端口号、包长度、校验号
- 传输方式： TCP是流式传输， UDP是包进行发送，是有边界的，但可能会乱序
- 分片不同：TCP 为了保证可靠性会进行分片，UDP则在IP层分片，自己不关心分片


TCP的应用场景

- FTP 文件传输
- HTTP/ HTTPS

UDP的场景

- 包总量少的通信 DNS、SNMP
- 即时视频、音频
- 广播通信

#### 为什么UDP 头部有包长度，TCP没有？

TCP可以计算出来
TCP 数据长度 = IP总长度 - IP头 - TCP头

UDP 为了快，所以不想这么计算，直接用空间换时间

#### 为什么TCP 有首部长度，UDP没有？

UDP是固定的
TCP 是有可选选项字段的

### TCP 和UDP 能共用字段吗？ 为什么？

可以，操作系统存在两种传输协议，两种协议在内核种使用了两种软件模块

![传输层](https://cdn.xiaolincoding.com/gh/xiaolincoder/network/port/tcp%E5%92%8Cudp%E6%A8%A1%E5%9D%97.jpeg)

网络层会根据报文的头按照两种协议，分别传给UDP模块和TCP模块，两者最后传输给两类端口

## TCP连接建立

### TCP 怎么建立三次握手？

![三次握手](https://img1.imgtp.com/2023/09/26/brzne9QG.png)

- 客户端发送SYN 及序列号 X， 进入SYN_SENT 此时不收到ACK就会超时重传
- 服务端收到后回复 ACK 及 seq = Y 及 Ack NUM = X+1 进入 SYN_RCVD
- 客服端收到后，会发送ACK ack = Y + 1 创建完成， 服务端收到后也会创建完成

