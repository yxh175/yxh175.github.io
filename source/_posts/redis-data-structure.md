---
title: Redis数据结构
date: 2023-09-17 16:49:33
categories:
- 八股文
tags: 
- redis
---

## Redis 数据类型

- String  字符串 
- List  列表
- Set   集合
- Zset  有序集合
- Hash  哈希
- BitMap
- HyperLogLog
- GEO
- Stream

结合一张图可以大致了解使用情况

![Redis 数据类型](https://cdn.xiaolincoding.com/gh/xiaolincoder/redis/%E5%85%AB%E8%82%A1%E6%96%87/key.png)


## 各个数据类型的场景

|结构体类型|结构体存储的值|结构体的读写能力|使用场景|
|---|---|---|---|
|String|字符串、整数、浮点数|对整个字符串或字符串的一部分进行操作，对数进行自增或自减的操作|缓存对象、常规计数、分布式锁、共享session信息|
|List|一个链表，每个节点都包含一个字符串|对链表的两端进行push和pop操作，根据值查找和删除元素|消息队列（需要自己生成全局ID，不能以消费组的形式消费数据）|
|Hash|包含键值对的无序散列表|添加、获取、删除操作|缓存对象、购物车等|
|Set|包含字符串的无序集合|字符串的集合，包含添加、删除、获取。包含计算交集、并集、差集|聚合计算场景如：点赞、共同关注、抽奖活动|
|Zset|和散列一样，用于存储键值对|字符串成员与浮点分数的有序映射，元素排列由分数的大小决定，包含方法有添加、获取、删除单个元素及以分值范围或成员来获取元素|排行榜、电话、姓名排序|
|BitMap|一串连续的二进制字节数组|对每个bit都利用起来，设置值、获取值、指定范围的值|二值统计场景如 签到打卡|
|HyperLogLog|提供元素|添加、返回计算估值、合并，根据元素概率提供不精确的去重计数|UV计数、WordCount等|
|GEO|存储地理位置信息，实现位置计算|存储、返回位置、返回两点位置、根据位置查询范围|滴滴打车|
Stream|消息流和消费者组。消息流是一个有序的消息集合，每个消息都有一个唯一的 ID。消费者组包含多个消费者，它们可以协作地消费消息流中的消息，并通过应答来跟踪处理进度。|命令比较多，之后总结|消息队列|


## 五种常见的数据类型怎么底层实现？

### string 实现

String底层类型是动态字符串SDS。其特点

- 不仅可以保存字符还能保存二进制
- SDS 获取字符串长度的时间复杂度为O(1),存在一个len属性
- Redis 的SDS API是安全二点，拼接字符串不会造成缓冲区溢出，会自动进行扩容

### List 内部实现

List的底层是双向链表和压缩列表实现

- 当链表数量小于512个，列表元素的值都小于64字节，redis会使用压缩列表作为List类型的底层数据结构
- 当列表不满足上面要求时，会使用双向链表作为List的底层数据结构

3.2版本之后统一使用了quickList

### Hash 内部实现

Hash的底层由压缩列表或哈希表实现

- 如果哈希类型元素小于512个，所有字节都小于64KB，Redis会使用压缩列表作为存储方法
- 否则会使用hash表实现

7.0版本之后统一使用listquick实现

### Set 类型内部实现

Set 类型是由hash表或整数集合实现

- 如果set中都是整数且数量小于512则使用整数集合
- 否则使用hash表实现

### Zset 类型内部实现

Zset 内部由压缩列表和跳表实现

- 元素小于128个且每个小于64字节使用压缩列表
- 否则使用跳表实现

7.0版本后由listpack实现
