---
title: mysql锁介绍
date: 2023-09-15 21:32:56
categories:
- 八股文
tags:
- mysql
- 锁
- 并发安全
---

# Mysql 锁

现在后端对高并发的要求很高。当时暑期实习面腾讯云智、小米都被问到Redis怎么实现分布式锁。我当时寻思我写的是了解啊。

不吹水了，看看Mysql的锁机制怎么实现（内容参考小林Coding）

## 全局锁

全局锁就是将mysql整个数据库锁住（很暴力）

### 全局锁怎么用的？

要使用全局锁，需要执行这个命令

```mysql
flush tables with read lock
```

整个数据库会进入只读状态
任何增、删、改的操作都会被阻塞

解锁使用

```mysql
unlock tables
```

还有一种解锁方法，是命令发起者的会话断开

### 全局锁的应用场景是什么？

全局锁一般用在全局备份上, 因为此时数据在备份是无法在一瞬间备份的。万一头尾数据存在一致性关联。可能会出现头备份完成，尾部修改导致的数据不一致

### 加全局锁的缺点是什么？

全局锁，意味着整个数据库是只读状态。这样只能读不能写，一定情况下会影响业务。

### 除了加全局锁备份，还有其他备份方式吗？

`MVCC`后面会介绍到，`Mysql`的灵魂。通过`ReadView`进行备份

如何操作？

使用`mysqldump`工具，在使用`mysqldump`时加上`–single-transaction` 参数的时候，就会在备份数据库之前先开启事务。

## 表级锁

### Mysql表级锁有哪些？具体怎么用的

Mysql表级锁大概有四个

- 表锁
- 元数据锁
- 意向锁
- AUTO-INC锁

#### 表锁

表锁就是加在整个表的锁

```mysql
// 读锁
lock table t_student read;
// 写锁
lock table t_student write;

// 释放当前会话的锁
unlock tables
```

#### 元数据锁

首先要知道什么是元数据呢？

元数据（Metadata）是关于数据的数据，它提供了关于数据的描述、定义和管理信息。元数据通常用于帮助组织、理解、搜索和管理数据（数据库对象结构、表、索引等）

