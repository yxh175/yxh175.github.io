<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="鼠鼠我呀要努力啦">
<meta property="og:type" content="website">
<meta property="og:title" content="鼠鼠的随笔">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="鼠鼠的随笔">
<meta property="og:description" content="鼠鼠我呀要努力啦">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yxh">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>鼠鼠的随笔</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鼠鼠的随笔</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/22/Interview-experience-KingSoft-WPS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/22/Interview-experience-KingSoft-WPS/" class="post-title-link" itemprop="url">面经：金山办公服务端开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-09-22 12:56:12 / 修改时间：18:59:53" itemprop="dateCreated datePublished" datetime="2023-09-22T12:56:12+08:00">2023-09-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9D%A2%E7%BB%8F/" itemprop="url" rel="index"><span itemprop="name">面经</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/22/Interview-experience-KingSoft-WPS/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/22/Interview-experience-KingSoft-WPS/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一面"><a href="#一面" class="headerlink" title="一面"></a>一面</h2><p>总共分为三个环节</p>
<ul>
<li>自我介绍</li>
<li>简历提问</li>
<li>算法考查</li>
</ul>
<h3 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h3><p>首先自我介绍了一下</p>
<h3 id="提问环节"><a href="#提问环节" class="headerlink" title="提问环节"></a>提问环节</h3><p>先是问一下比较基础的八股，然后逐渐变难的</p>
<h4 id="IP层有哪些协议？"><a href="#IP层有哪些协议？" class="headerlink" title="IP层有哪些协议？"></a>IP层有哪些协议？</h4><ul>
<li>DNS 用来根据域名进行网络查询</li>
<li>ARP 根据IP查询点之间的mac地址</li>
<li>DHCP 自动分配IP地址</li>
<li>NAT 私有地址转换为外网地址</li>
<li>ICMP 确认IP包是否成功送达到目标地址</li>
<li>IGMP</li>
</ul>
<h4 id="讲一下TCP的三次握手"><a href="#讲一下TCP的三次握手" class="headerlink" title="讲一下TCP的三次握手"></a>讲一下TCP的三次握手</h4><p>TCP三次握手即客户端和服务端连接时，两个者进行三次沟通的过程</p>
<ul>
<li>客户端发送SYNC + 随机seq序列号X</li>
<li>服务端监听到后回复ACK+SYNC ACK num&#x3D; X+1 SeqNum &#x3D; Y </li>
<li>客户端收到后， 回复ACK Ack num &#x3D; Y+1</li>
</ul>
<h4 id="为什么TCP连接要有seq序列号？"><a href="#为什么TCP连接要有seq序列号？" class="headerlink" title="为什么TCP连接要有seq序列号？"></a>为什么TCP连接要有seq序列号？</h4><ul>
<li>在TCP三次握手中保证了三次握手检查，不会有历史连接干扰</li>
<li>在传输时能进行报文的控制，方便进行拥塞控制、丢失重传、流量控制</li>
</ul>
<h4 id="讲一下四次挥手"><a href="#讲一下四次挥手" class="headerlink" title="讲一下四次挥手"></a>讲一下四次挥手</h4><p>TCP 四次挥手是客户端和服务端断开，进行的一个操作，保证TCP连接的正常断开</p>
<p>假设客户端主动关闭的时候</p>
<ul>
<li>客户端发送FIN请求 seq &#x3D; x、ack &#x3D; y</li>
<li>服务端收到FIN请求，回复ACK seq &#x3D; y 、ack &#x3D; x+1，进入Close_Wait并结束进程，进行最后的资源释放</li>
<li>等资源处理完毕后，发送FIN seq &#x3D; y、ack &#x3D; x + 1</li>
<li>此时客户端会进入Time_Wait状态发送ACK  seq &#x3D; x + 1， ack &#x3D; y + 1</li>
</ul>
<p>发送成功后，两者就进行了正常关闭</p>
<h4 id="为什么要有Time-Wait状态？"><a href="#为什么要有Time-Wait状态？" class="headerlink" title="为什么要有Time_Wait状态？"></a>为什么要有Time_Wait状态？</h4><ul>
<li>防止历史连接的数据影响新的连接，要让本次报文中的数据尽可能的在网络中消失掉。</li>
<li>保证被关闭的一方能够正确的关闭，多次监听服务端的消息，如果服务端再次发送关闭请求到客户端，说明自己的发送失败了。需要确保对方成功关闭</li>
</ul>
<h4 id="HTTP协议中一般有哪些状态码"><a href="#HTTP协议中一般有哪些状态码" class="headerlink" title="HTTP协议中一般有哪些状态码"></a>HTTP协议中一般有哪些状态码</h4><ul>
<li>1XX 属于提示信息，协议处理的中间态，一般用到的比较少</li>
<li>2XX 表示成功处理客户端的请求，是我们最想看到的如：200、204</li>
<li>3XX 表示资源发生了变动，如：301、302、304</li>
<li>4XX 表示客户端发送的报文有误如 404 资源不存在</li>
<li>5XX 表示服务端内部异常 如 500、501、502、503</li>
</ul>
<h4 id="499-状态码是做什么的有了解吗？"><a href="#499-状态码是做什么的有了解吗？" class="headerlink" title="499 状态码是做什么的有了解吗？"></a>499 状态码是做什么的有了解吗？</h4><p>这个没答上来。回答了说平时只了解过40x左右的。开发的时候没怎么见过</p>
<p>随后搜索：<br>499， Client Closed Request<br>这个表示客户端主动断开连接<br>是指一次http请求在客户端指定的时间内没有返回响应，此时客户端会主动断开连接，此时表象为客户端无响应返回，而nginx的日志会status code 499</p>
<h4 id="讲一下HTTPS的协议？"><a href="#讲一下HTTPS的协议？" class="headerlink" title="讲一下HTTPS的协议？"></a>讲一下HTTPS的协议？</h4><p>HTTPS 是基于HTTP的明文传输与不安全。所以在TCP三次握手后增加了TSL层作数据安全性的保证，通过TSL四次握手进行对称密钥的生成，实现对话过程中的加密。HTTPS可以保证主要用来保证信息的机密性、摘要算法的方式实现完整性、数字证书解决被冒充的方法</p>
<h4 id="HTTPS-能被抓包吗？"><a href="#HTTPS-能被抓包吗？" class="headerlink" title="HTTPS 能被抓包吗？"></a>HTTPS 能被抓包吗？</h4><p>我理解错了他的意思，以为问的是HTTPS能被窃听吗，所以回答成了：在保证对话密钥不被窃取，证书没有伪造的情况下。是不会被抓包的</p>
<p>理论答案：<br>可以通过抓包调试，通过抓包工具，并在手机中放好证书。保证系统能使用这个证书的情况下，就可以抓取到Https的内容</p>
<h4 id="有没有用过HTTPS抓包？"><a href="#有没有用过HTTPS抓包？" class="headerlink" title="有没有用过HTTPS抓包？"></a>有没有用过HTTPS抓包？</h4><p>当时脑子抽抽了，以为把抓包的意思理解错了，说没有T-T 实际上还是有的</p>
<p>正确回答：<br>通过抓包工具，把证书下载好，设置拦截端口号并拦截所发送的请求。即可得到解密后的包</p>
<h4 id="Golang-的GMP调度模式？"><a href="#Golang-的GMP调度模式？" class="headerlink" title="Golang 的GMP调度模式？"></a>Golang 的GMP调度模式？</h4><p>可以参考这篇文档<a target="_blank" rel="noopener" href="https://juejin.cn/post/7044741465930465311">Go GMP</a>的图解，讲的非常清楚。为了方便，我就直接用他的图了</p>
<p>golang 的GMP调度老生常谈了</p>
<ul>
<li>G goroutine 代表程序中的协程</li>
<li>M machine 代表内核线程</li>
<li>P process 代表处理器</li>
</ul>
<p>P 会有一些本地队列，根据MAXPROCES 确定P的数量，P本地有个本地队列，用来存放协程。通过调用M来使用协程能够在M上运行。这样能保证M的线程能够多次复用，而且更加轻量。<br>为了保证协程资源分配的均匀提出了两个机制</p>
<ul>
<li>hand off 机制当本地线程M1因为G进行的系统调用阻塞时，线程释放绑定的P， 把P转移给其他空闲的M0执行</li>
</ul>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3df5d4f14311450dada8f4d6da82b896~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="hand off 机制"></p>
<ul>
<li>work stealing 机制</li>
</ul>
<p>当本线程无G可运行时，从其他线程绑定的P窃取G，而不是直接销毁线程</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5b7c21037ed401292ec01aadfd906ea~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="work stealing 机制"></p>
<h4 id="怎么保证一个协程能一直占用一个CPU？"><a href="#怎么保证一个协程能一直占用一个CPU？" class="headerlink" title="怎么保证一个协程能一直占用一个CPU？"></a>怎么保证一个协程能一直占用一个CPU？</h4><p>加自旋锁让协程一直占用CPU。</p>
<h4 id="golang-怎么保证多个协程对int64进行增加不异常？"><a href="#golang-怎么保证多个协程对int64进行增加不异常？" class="headerlink" title="golang 怎么保证多个协程对int64进行增加不异常？"></a>golang 怎么保证多个协程对int64进行增加不异常？</h4><ul>
<li>sync.Mutex 互斥锁</li>
<li>sync.RWMutex 读写锁</li>
<li>Atomic.AddInt64() CAS锁</li>
</ul>
<h4 id="看你写了JAVA，-问你一点JAVA？"><a href="#看你写了JAVA，-问你一点JAVA？" class="headerlink" title="看你写了JAVA， 问你一点JAVA？"></a>看你写了JAVA， 问你一点JAVA？</h4><p>直接说不会T-T，学的皮毛，遂跳过</p>
<h4 id="Mysql-索引结构是什么样的？"><a href="#Mysql-索引结构是什么样的？" class="headerlink" title="Mysql 索引结构是什么样的？"></a>Mysql 索引结构是什么样的？</h4><p>B+树，是一种m度的树。它的特点就是在非叶子节点不会存放值。并且所有的值都会存放在叶子节点上，并用双向链表进行连接</p>
<h4 id="为什么要用B-树做索引"><a href="#为什么要用B-树做索引" class="headerlink" title="为什么要用B+树做索引"></a>为什么要用B+树做索引</h4><ul>
<li>插入和删除效率</li>
<li>范围查询更加方便</li>
</ul>
<h4 id="怎么用redis实现一个分布式锁？"><a href="#怎么用redis实现一个分布式锁？" class="headerlink" title="怎么用redis实现一个分布式锁？"></a>怎么用redis实现一个分布式锁？</h4><p>通过Set NX PX&#x2F;EX 两个字段保证分布式锁只有一个能加和超时自动清楚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET lock_key unique_value NX PX 10000 </span><br></pre></td></tr></table></figure>

<h4 id="怎么删除这个分布式锁？"><a href="#怎么删除这个分布式锁？" class="headerlink" title="怎么删除这个分布式锁？"></a>怎么删除这个分布式锁？</h4><p>通过判断lock_key value 是否是一个客户端。要保证执行操作的客户端就是加锁的客户端，所以解锁的时候要先判断 unique_value是否是当前客户端，是的话就删除锁</p>
<h4 id="怎么保证原子性？"><a href="#怎么保证原子性？" class="headerlink" title="怎么保证原子性？"></a>怎么保证原子性？</h4><p>通过Lua脚本实现</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 释放锁时，先比较 unique_value 是否相等，避免锁的误释放</span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="Redis-有Stop-The-World的发生吗？"><a href="#Redis-有Stop-The-World的发生吗？" class="headerlink" title="Redis 有Stop The World的发生吗？"></a>Redis 有Stop The World的发生吗？</h4><p>刚开始听说STW以为是听错了。我说Redis没有STW的发生。他问一下我确定吗，Redis毕竟是一个单线程的。我一听就问他说的是不是主线程阻塞的问题。他说是就开始回答正常八股了</p>
<p>Redis 主线程会被大Key：Value阻塞主线程。因为在写日志的时候，大Key 导致的刷盘时间长，从而阻塞了主进程。这里<a target="_blank" rel="noopener" href="https://xiaolincoding.com/redis/storage/bigkey_aof_rdb.html#%E5%A4%A7-key-%E5%AF%B9-aof-%E9%87%8D%E5%86%99%E5%92%8C-rdb-%E7%9A%84%E5%BD%B1%E5%93%8D">小林coding</a>讲的很详细</p>
<hr>
<p>这里八股就问差不多了，然后就问一些简单的算法题，只需要说思路就行</p>
<h4 id="100-个-10万数据的顺序表，怎么合并成一个新的顺序表？"><a href="#100-个-10万数据的顺序表，怎么合并成一个新的顺序表？" class="headerlink" title="100 个 10万数据的顺序表，怎么合并成一个新的顺序表？"></a>100 个 10万数据的顺序表，怎么合并成一个新的顺序表？</h4><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/merge-sorted-array/">合并两个有序数组</a>，直接说了，问是什么时间复杂度<br>O（100n） ？</p>
<p>不是太确定，说是对的</p>
<h4 id="长URL-映射到短URL"><a href="#长URL-映射到短URL" class="headerlink" title="长URL 映射到短URL"></a>长URL 映射到短URL</h4><p>刚开始不知道问的什么意思，说了半天也没理解，最后问了答案才知道是啥意思。<br>就是一个长URL通过62位编码转换成短URL，网上有相关的解释，不放了</p>
<h4 id="问项目、问实习"><a href="#问项目、问实习" class="headerlink" title="问项目、问实习"></a>问项目、问实习</h4><p>这里还行，挖的不是很深，感觉面试官只要觉得这里你是懂得就不深究，很松。</p>
<h3 id="反问"><a href="#反问" class="headerlink" title="反问"></a>反问</h3><h4 id="第二题是什么意思？答案是什么"><a href="#第二题是什么意思？答案是什么" class="headerlink" title="第二题是什么意思？答案是什么"></a>第二题是什么意思？答案是什么</h4><h4 id="部门的技术栈是Golang吗？"><a href="#部门的技术栈是Golang吗？" class="headerlink" title="部门的技术栈是Golang吗？"></a>部门的技术栈是Golang吗？</h4>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/21/go-complicate-interview-key-point/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/21/go-complicate-interview-key-point/" class="post-title-link" itemprop="url">GO：并发编程 面试重点</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-21 15:36:09" itemprop="dateCreated datePublished" datetime="2023-09-21T15:36:09+08:00">2023-09-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-22 09:28:40" itemprop="dateModified" datetime="2023-09-22T09:28:40+08:00">2023-09-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">面试</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9D%A2%E8%AF%95/%E5%85%AB%E8%82%A1/" itemprop="url" rel="index"><span itemprop="name">八股</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/21/go-complicate-interview-key-point/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/21/go-complicate-interview-key-point/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Mutex是什么？怎么go中使用？"><a href="#Mutex是什么？怎么go中使用？" class="headerlink" title="Mutex是什么？怎么go中使用？"></a>Mutex是什么？怎么go中使用？</h2><p>Mutex 是go语言中的一种互斥锁，作用是给临界区的数据加锁，保证一次只能有一个协程去访问某个数据</p>
<p>在go语言中，通过<code>sync.Mutex</code>实现Mutex锁，Mutex内部是一个结构体</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Mutex <span class="keyword">struct</span> &#123;</span><br><span class="line">	state <span class="type">int32</span></span><br><span class="line">	sema  <span class="type">uint32</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过Locker来保证互斥锁， 实战一下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// mutex锁</span></span><br><span class="line">	mutex := sync.Mutex&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	res := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			<span class="comment">// 如果不加会是一个无法确定的输出</span></span><br><span class="line">			mutex.Lock()</span><br><span class="line">			res += <span class="number">1</span></span><br><span class="line">			mutex.Unlock()</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过Mutex保证自增不会异常。</p>
<h3 id="为什么不加Lock会异常？"><a href="#为什么不加Lock会异常？" class="headerlink" title="为什么不加Lock会异常？"></a>为什么不加Lock会异常？</h3><p>这个涉及到了加法运算的问题了，加来说一个CPU在加的过程是在加法器上算的，如果此时切换到其他协程上去，这个值就还没有赋值上，其它的协程就进行了累加，但是是基于原本的结果。下次切换没加上的这个协程时就是赋值原先的结果。</p>
<h2 id="Mutex-锁有什么模式？"><a href="#Mutex-锁有什么模式？" class="headerlink" title="Mutex 锁有什么模式？"></a>Mutex 锁有什么模式？</h2><h3 id="正常模式（非公平锁）"><a href="#正常模式（非公平锁）" class="headerlink" title="正常模式（非公平锁）"></a>正常模式（非公平锁）</h3><p>正常模式即是，等待队列中的协程按照FIFO的顺序等待，唤醒的goroutine不会直接获得锁，而是和当前新请求的goroutine竞争锁，但是新请求的goroutine是运行在CPU上的，所以刚唤醒的goroutine很大概率会竞争失败，加入到等待队列的前面</p>
<h3 id="饥饿模式（公平锁）"><a href="#饥饿模式（公平锁）" class="headerlink" title="饥饿模式（公平锁）"></a>饥饿模式（公平锁）</h3><p>为了解决等待goroutine队列的长尾问题，饥饿模式下，直接由unlock把锁交给等待队列中排在第一位的goroutine中，同时饥饿模式下goroutine不会参与抢锁也不会进入自旋状态，会直接进入等待队列的尾部，这样可以防止goroutine一直抢不到锁</p>
<h3 id="何时进入饥饿模式？"><a href="#何时进入饥饿模式？" class="headerlink" title="何时进入饥饿模式？"></a>何时进入饥饿模式？</h3><ul>
<li>当一个 goroutine 等待锁时间超过 1 毫秒时</li>
</ul>
<h3 id="何时退出？"><a href="#何时退出？" class="headerlink" title="何时退出？"></a>何时退出？</h3><p>当waiter队列获取到锁且满足以下任意条件</p>
<ul>
<li>当前队列只剩下一个 goroutine 的时候，Mutex 切换到饥饿模式。</li>
<li>它等待获取锁的时间 &lt; 1ms</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>对于两种模式，正常模式下的性能是最好的，goroutine 可以连续多次获取锁，饥饿模式解决了取锁公平的问题，但是性能会下降，这其实是性能和公平的一个平衡模式。</p>
<h2 id="自旋锁和等待锁"><a href="#自旋锁和等待锁" class="headerlink" title="自旋锁和等待锁"></a>自旋锁和等待锁</h2><ul>
<li>自旋锁就是依旧占用CPU，等自旋结束后就会直接进行工作</li>
<li>等待锁就是释放CPU，等待被唤醒时使用CPU，不占用额外的资源</li>
</ul>
<h2 id="RWMutex-锁"><a href="#RWMutex-锁" class="headerlink" title="RWMutex 锁"></a>RWMutex 锁</h2><ul>
<li>RWMutex 是单写多读锁，该锁可以加多个读锁或者一个写锁</li>
<li>写锁会阻止其他 Goroutine（无论读和写）进来，整个锁由该 Goroutine独占</li>
<li>适用于读多写少的场景</li>
<li>RWMutex 的读锁或写锁在未锁定状态，解锁操作都会引发 panic</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="number">1</span></span><br><span class="line">	rw := sync.RWMutex&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> read(&amp;m, &amp;rw, &amp;wg)</span><br><span class="line">	<span class="keyword">go</span> write(&amp;m, &amp;rw, &amp;wg)</span><br><span class="line">	<span class="keyword">go</span> read(&amp;m, &amp;rw, &amp;wg)</span><br><span class="line"></span><br><span class="line">	wg.Wait()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(m *<span class="type">int</span>, rw *sync.RWMutex, wg *sync.WaitGroup)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	rw.RLock()</span><br><span class="line">	fmt.Println(*m)</span><br><span class="line">	time.Sleep(time.Second)</span><br><span class="line">	rw.RUnlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(m *<span class="type">int</span>, rw *sync.RWMutex, wg *sync.WaitGroup)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	rw.Lock()</span><br><span class="line">	*m = <span class="number">2</span></span><br><span class="line">	fmt.Println(*m)</span><br><span class="line">	rw.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/21/interview-TCP-key-point/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/21/interview-TCP-key-point/" class="post-title-link" itemprop="url">面试重点知识点：TCP相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-09-21 11:24:42 / 修改时间：15:35:11" itemprop="dateCreated datePublished" datetime="2023-09-21T11:24:42+08:00">2023-09-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%AB%E8%82%A1%E6%96%87/" itemprop="url" rel="index"><span itemprop="name">八股文</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/21/interview-TCP-key-point/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/21/interview-TCP-key-point/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文主要参考<a target="_blank" rel="noopener" href="https://xiaolincoding.com/network/3_tcp/tcp_interview.html#tcp-%E5%A4%B4%E6%A0%BC%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B">小林coding</a></p>
<h2 id="TCP-基本认识"><a href="#TCP-基本认识" class="headerlink" title="TCP 基本认识"></a>TCP 基本认识</h2><h3 id="TCP头格式有哪些？"><a href="#TCP头格式有哪些？" class="headerlink" title="TCP头格式有哪些？"></a>TCP头格式有哪些？</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/20/tuhuyangche-exam/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/20/tuhuyangche-exam/" class="post-title-link" itemprop="url">笔试题：途虎养车JAVA开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-09-20 20:42:06 / 修改时间：21:28:00" itemprop="dateCreated datePublished" datetime="2023-09-20T20:42:06+08:00">2023-09-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">笔试</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/20/tuhuyangche-exam/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/20/tuhuyangche-exam/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>途虎第三题没写出来，记录一下，复述一下题目大概</p>
<p>给定一些坐标，这些坐标是城市的坐标，(如果每个坐标在一行或者在一列的话则表示两者是可以互相到达的，此时二者只需建立一个工厂)，现在给定一系列坐标，问最少要建多少个工厂</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入</span><br><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="number">0</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">输出</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>刚开始钻牛角尖了，老想着用dfs。实际上是不需要的，因为dfs是为了找到下一个可达点的位置。而这里，坐标全部给你了。只需要你遍历一边。维护一个n*m的表来判断能不能到达</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	nums := [][]<span class="type">int</span>&#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">2</span>&#125;, &#123;<span class="number">2</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">2</span>&#125;&#125;</span><br><span class="line">	fmt.Println(needFactory(nums))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">needFactory</span><span class="params">(nums [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	rowLen, colLen := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">	<span class="comment">// 找到坐标</span></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		rowLen = max(num[<span class="number">0</span>], rowLen)</span><br><span class="line">		colLen = max(num[<span class="number">1</span>], colLen)</span><br><span class="line">	&#125;</span><br><span class="line">	rowLen += <span class="number">1</span></span><br><span class="line">	colLen += <span class="number">1</span></span><br><span class="line">	visited := <span class="built_in">make</span>([][]<span class="type">bool</span>, rowLen)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; rowLen; i++ &#123;</span><br><span class="line">		visited[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, colLen)</span><br><span class="line">	&#125;</span><br><span class="line">	cnt := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		x, y := num[<span class="number">0</span>], num[<span class="number">1</span>]</span><br><span class="line">		<span class="keyword">if</span> !visited[x][y] &#123;</span><br><span class="line">			cnt++</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> i := x; i &lt; rowLen; i++ &#123;</span><br><span class="line">			visited[i][y] = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> i := y; i &lt; colLen; i++ &#123;</span><br><span class="line">			visited[x][i] = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cnt</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终答案和测试样例结果相同</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/20/network-http-study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/20/network-http-study/" class="post-title-link" itemprop="url">计算机网络：HTTP知识点遗忘点记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-20 16:35:47" itemprop="dateCreated datePublished" datetime="2023-09-20T16:35:47+08:00">2023-09-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-21 11:02:10" itemprop="dateModified" datetime="2023-09-21T11:02:10+08:00">2023-09-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%AB%E8%82%A1%E6%96%87/" itemprop="url" rel="index"><span itemprop="name">八股文</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/20/network-http-study/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/20/network-http-study/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>记录一下自己HTTP的相关薄弱点。强化一下学习<br>文章内容参考<a target="_blank" rel="noopener" href="https://xiaolincoding.com/network/2_http/http_interview.html#https-%E6%98%AF%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E7%9A%84-%E5%85%B6%E9%97%B4%E4%BA%A4%E4%BA%92%E4%BA%86%E4%BB%80%E4%B9%88">小林coding</a></p>
<h2 id="HTTPs-的应用数据如何保证完整性"><a href="#HTTPs-的应用数据如何保证完整性" class="headerlink" title="HTTPs 的应用数据如何保证完整性"></a>HTTPs 的应用数据如何保证完整性</h2><p>这个问题，主要考查的是，HTTPs构建完对话后，如何去实现数据的传递，因为HTTPs传递消息不会像HTTP那样随意的明文传输，它还需要一个对称加密的过程。<br>这里涉及TLS的两个协议：</p>
<ul>
<li>TLS握手协议： 四次握手算法，负责协商加密算法和生成对称密钥的。</li>
<li>TLS记录协议：负责保护应用程序数据并验证其完整性和来源，所以对HTTP数据加密是使用记录协议</li>
</ul>
<p>TLS记录协议主要负责消息（HTTP数据）的压缩，加密及数据的认证。<br><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/HTTP/%E8%AE%B0%E5%BD%95%E5%8D%8F%E8%AE%AE.png" alt="TLS处理信息的过程"></p>
<p>过程如下：</p>
<ul>
<li>消息分割：消息被分割成多个片段</li>
<li>片段压缩：消息通过压缩算法进行压缩</li>
<li>MAC生成：通过Hash算法对压缩片段生成MAC并追加到尾部</li>
<li>对称加密：通过对称密钥进行加密</li>
<li>生成报文：由数据类型、版本号、压缩后的长度组成最终报文</li>
</ul>
<h2 id="HTTP-2做了什么优化？"><a href="#HTTP-2做了什么优化？" class="headerlink" title="HTTP&#x2F;2做了什么优化？"></a>HTTP&#x2F;2做了什么优化？</h2><p>HTTP&#x2F;2协议是基于HTTPS的，所以HTTP&#x2F;2的安全性也是有保障的</p>
<p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/HTTP/25-HTTP2.png" alt="HTTP各版本架构"></p>
<p>根据这些图可以看到HTTP&#x2F;2相比于HTTP&#x2F;1.1的一些改进</p>
<ul>
<li>头部压缩：<code>HPACK</code>算法，通过维护一个头信息对应信息表，用索引号来表示字段。</li>
<li>二进制格式： 头信息和body都采用二进制传输</li>
<li>并发传输：引用Stream概念，多个Stream在一条TCP中复用。通过Stream ID 让接收方变得排序，服务端可以乱序发送</li>
<li>服务器推送：服务器会主动向客户端推送可能会用到的资源</li>
</ul>
<h2 id="HTTP-2有什么缺陷？"><a href="#HTTP-2有什么缺陷？" class="headerlink" title="HTTP&#x2F;2有什么缺陷？"></a>HTTP&#x2F;2有什么缺陷？</h2><p>HTTP&#x2F;2 通过Stream的并发能力，虽然解决了HTTP&#x2F;1队头阻塞的问题，但还是存在TCP的队头阻塞。因为HTTP&#x2F;2是基于TCP的。TCP 是字节流协议，TCP 层必须保证收到的字节数据是完整且连续的，这样内核才会将缓冲区里的数据返回给 HTTP 应用，那么当「前 1 个字节数据」没有到达时，后收到的字节数据只能存放在内核缓冲区里，只有等到这 1 个字节数据到达时，HTTP&#x2F;2 应用层才能从内核中拿到数据，这就是 HTTP&#x2F;2 队头阻塞问题。</p>
<p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/network/quic/http2%E9%98%BB%E5%A1%9E.jpeg" alt="stream丢失片段"></p>
<p>当通过TCP发送多个包的时候，如果有一个包在网络中丢失，那么就会导致之后的内容会在内核中缓存。直到丢失的包收到。应用层才能在内核中取到结果<br><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/%E7%BD%91%E7%BB%9C/http3/tcp%E9%98%9F%E5%A4%B4%E9%98%BB%E5%A1%9E.gif" alt="内核运行图"></p>
<p>所以，一旦发生了丢包现象，就会触发 TCP 的重传机制，这样在一个 TCP 连接中的所有的 HTTP 请求都必须等待这个丢了的包被重传回来。</p>
<h2 id="HTTP-3-做了哪些优化？"><a href="#HTTP-3-做了哪些优化？" class="headerlink" title="HTTP&#x2F;3 做了哪些优化？"></a>HTTP&#x2F;3 做了哪些优化？</h2><p>我们看到HTTP&#x2F;2做了很大的努力，让HTTP层面不出现队头阻塞，但是还是在TCP层上折了腰。<br>所以HTTP&#x2F;3将底层修改为UDP协议。</p>
<p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/HTTP/27-HTTP3.png" alt="HTTP各版本"></p>
<p>基于UDP的quick协议可以实现可靠传输。</p>
<p>那么HTTP&#x2F;3的三个优点就是</p>
<ul>
<li>无队头阻塞：同样是多路复用但是不会像HTTP&#x2F;2那样当stream某个出现丢失时阻塞。UDP中多个Stream之间没有依赖</li>
<li>更快的建立连接：因为QUIC协议里包含了TLS协议。所以直接握手就可以了</li>
<li>连接迁移：基于TCP的连接，强调了地址和端口号。如果二者有一点变化就需要重新连接，代价很高。而基于UDP的不需要</li>
</ul>
<h2 id="quick协议怎么让UDP实现可靠传输的？"><a href="#quick协议怎么让UDP实现可靠传输的？" class="headerlink" title="quick协议怎么让UDP实现可靠传输的？"></a>quick协议怎么让UDP实现可靠传输的？</h2><p>HTTP&#x2F;3的整体视角是这样的</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/http3-over-quic-protocol-works.png" alt="HTTP/3整体情况"></p>
<ul>
<li>Packet Header  分别包含了Long Packet Header 和 Short Packet Header两种实现方法，前者在首次连接时使用，后者用于日常传输</li>
<li>QUIC FrameHeader 在一个Packet中会存放多个Frame数据， 这个Frame数据内容大致如下<br><img src="https://cdn.xiaolincoding.com//mysql/other/536298d2c54a43b699026bffe0f85010.png" alt="Frame内容"></li>
</ul>
<p>通过StreamID、Offset保证数据的有序性，length指明了Frame数据的长度</p>
<h3 id="quic-ID-是什么样的，和TCP一样吗？"><a href="#quic-ID-是什么样的，和TCP一样吗？" class="headerlink" title="quic ID 是什么样的，和TCP一样吗？"></a>quic ID 是什么样的，和TCP一样吗？</h3><p>不是，quicID 在UDP中严格递增的，为了保证RTT（往返延时时间的无歧义测量）,所以让它严格递增，这也顺便解决了TCP中RTT歧义性导致重发事件概率增大</p>
<h3 id="为什么QUIC-不会队头阻塞？"><a href="#为什么QUIC-不会队头阻塞？" class="headerlink" title="为什么QUIC 不会队头阻塞？"></a>为什么QUIC 不会队头阻塞？</h3><p>HTTP&#x2F;2 队头阻塞的原因是因为TCP, 虽然在应用层的层面上解决队头阻塞问题，但是在其Stream是基于TCP的，TCP滑动窗口的阻塞会导致队头阻塞。而HTTP&#x2F;3是基于UDP的，UDP会为每个Stream单独弄一个窗口。这样各个Stream之间是不会互相影响的</p>
<h3 id="QUIC-如何做到流量控制？"><a href="#QUIC-如何做到流量控制？" class="headerlink" title="QUIC 如何做到流量控制？"></a>QUIC 如何做到流量控制？</h3><p>和TCP原理类似，TCP流量控制是通过接收方告诉发送方，它的接收窗口有多大，从而让发送方计算发送速率</p>
<p>QUIC 实现流量控制的方式</p>
<ul>
<li>通过window_update 帧告知窗口大小</li>
<li>通过BlockFrame 帧告知阻塞</li>
</ul>
<p>同时和HTTP&#x2F;2不同的是Stream每个都是单独的窗口，所以要进行两个流量控制</p>
<ul>
<li>Stream流量控制， 对每个Stream的窗口进行限制</li>
<li>Connection 连接控制，对Stream总的连接大小进行限制，防止超过缓存</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/19/go-channel-various-situations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/19/go-channel-various-situations/" class="post-title-link" itemprop="url">Go：Channel各种情况下的情况</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-19 10:46:41" itemprop="dateCreated datePublished" datetime="2023-09-19T10:46:41+08:00">2023-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-20 20:41:49" itemprop="dateModified" datetime="2023-09-20T20:41:49+08:00">2023-09-20</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/19/go-channel-various-situations/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/19/go-channel-various-situations/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Channel情况解析"><a href="#Channel情况解析" class="headerlink" title="Channel情况解析"></a>Channel情况解析</h2><p>Channel 作为go协程编程中必要的一环，理解其原理和各种情况是必要的。如果加以利用这些特性。我们会在工作中可以保证安全的情况下探索各种玩法</p>
<p>一般我们看到别人讲channel的各种情况，都用文本写了一行又一行。感觉看不太懂，看完下面会忘了上面。所以我自己整理了整理各种情况并用图表示出来。供自己以后进行快速查找和记忆</p>
<p><img src="https://img1.imgtp.com/2023/09/19/hV0QoxLs.png" alt="channel各种情况"></p>
<p>上图可以很清晰的看到什么流程会导致什么情况。总结一些特殊的情况：</p>
<ul>
<li>关闭channel 读 返回0</li>
<li>关闭channel 写、关闭 panic</li>
<li>channel &#x3D; nil 后关闭会panic</li>
<li>channel &#x3D; nil channel将无法传递值了，正常使用它进行异步可能会阻塞</li>
<li>无缓冲读写都会阻塞必须同时进行··</li>
</ul>
<p>图中阻塞的channel是为了保证异步，如果处理不当，会出现死锁。</p>
<p>如果所有协程都进入了阻塞态，就会导致go报dealLock错误。所以在这些情况要注意，虽然有一些风险，但也会让我们收益更大。能做的事情更多</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/19/go-heap-coding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/19/go-heap-coding/" class="post-title-link" itemprop="url">GO：如何实现一个堆</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-09-19 09:10:36 / 修改时间：09:47:36" itemprop="dateCreated datePublished" datetime="2023-09-19T09:10:36+08:00">2023-09-19</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/19/go-heap-coding/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/19/go-heap-coding/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一些leetcode算法题中经常用到堆排序去解决问题比如常见</p>
<p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/kth-largest-element-in-an-array/">数组第K大个数</a><br><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-k-closest-elements/">658. 找到 K 个最接近的元素</a><br>Golang 给出了主要的实现堆队列的主要方法，但是由于堆的数据结构都可以使用，所以需要自己去实现一些必要的接口，才能正常使用一个堆</p>
<h2 id="堆的接口"><a href="#堆的接口" class="headerlink" title="堆的接口"></a>堆的接口</h2><p><code>heap.Interface</code> 接口源码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">	sort.Interface</span><br><span class="line">	Push(x <span class="keyword">interface</span>&#123;&#125;) <span class="comment">// add x as element Len()</span></span><br><span class="line">	Pop() <span class="keyword">interface</span>&#123;&#125;   <span class="comment">// remove and return element Len() - 1.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>sort.Interface</code> 接口源码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">	Len() <span class="type">int</span></span><br><span class="line">	<span class="comment">// Less reports whether the element with</span></span><br><span class="line">	<span class="comment">// index i should sort before the element with index j.</span></span><br><span class="line">	Less(i, j <span class="type">int</span>) <span class="type">bool</span></span><br><span class="line">	<span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">	Swap(i, j <span class="type">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说要实现一个堆，至少要实现以上的接口。所以我们要想使用heap定义的堆，就需要实现这五个方法。以下简单计算一个矩形面积的堆排序</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;container/heap&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">	width  <span class="type">int</span></span><br><span class="line">	height <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rec *Rectangle)</span></span> Area() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> rec.height * rec.width</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RectHeap []Rectangle</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hp RectHeap)</span></span> Len() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(hp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按从小到大排列</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hp RectHeap)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> hp[i].Area() &lt; hp[j].Area()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hp RectHeap)</span></span> Swap(i, j <span class="type">int</span>) &#123;</span><br><span class="line">	hp[i], hp[j] = hp[j], hp[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hp *RectHeap)</span></span> Push(h <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	*hp = <span class="built_in">append</span>(*hp, h.(Rectangle))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(hp *RectHeap)</span></span> Pop() (x <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(*hp)</span><br><span class="line">	x = (*hp)[n<span class="number">-1</span>]</span><br><span class="line">	*hp = (*hp)[:n<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	hp := &amp;RectHeap&#123;&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">2</span>; i &lt; <span class="number">6</span>; i++ &#123;</span><br><span class="line">		*hp = <span class="built_in">append</span>(*hp, Rectangle&#123;i, i&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;原始slice: &quot;</span>, hp)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 堆操作</span></span><br><span class="line">	heap.Init(hp)</span><br><span class="line">	heap.Push(hp, Rectangle&#123;<span class="number">100</span>, <span class="number">10</span>&#125;)</span><br><span class="line">	fmt.Println(<span class="string">&quot;top元素：&quot;</span>, (*hp)[<span class="number">0</span>])</span><br><span class="line">	fmt.Println(<span class="string">&quot;删除并返回最后一个：&quot;</span>, heap.Pop(hp)) <span class="comment">// 最后 一个元素</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;最终slice: &quot;</span>, hp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过实现五个接口需要实现的函数，即可完成要求</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/18/go-channel-coding-sytle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/18/go-channel-coding-sytle/" class="post-title-link" itemprop="url">GO：Channel专项面试题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-18 20:55:26" itemprop="dateCreated datePublished" datetime="2023-09-18T20:55:26+08:00">2023-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 09:09:17" itemprop="dateModified" datetime="2023-09-19T09:09:17+08:00">2023-09-19</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/18/go-channel-coding-sytle/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/18/go-channel-coding-sytle/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="协程打印123"><a href="#协程打印123" class="headerlink" title="协程打印123"></a>协程打印123</h2><p>使用协程多次交替打印123</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	ch1, ch2, ch3 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">0</span>), <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">0</span>), <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">0</span>)</span><br><span class="line">	wg.Add(<span class="number">3</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">			&lt;-ch1</span><br><span class="line">			fmt.Print(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">			ch2 &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		&lt;-ch1</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">			&lt;-ch2</span><br><span class="line">			fmt.Print(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">			ch3 &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">			&lt;-ch3</span><br><span class="line">			fmt.Print(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">			ch1 &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	ch1 &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过<code>channel</code>实现异步交替， 通过<code>waitGroup</code>实现主协程的等待</p>
<h2 id="如何优雅进行协程退出"><a href="#如何优雅进行协程退出" class="headerlink" title="如何优雅进行协程退出"></a>如何优雅进行协程退出</h2><p>通过<code>ctx</code>进行管道通信，通过<code>select</code>进行监听</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">	fmt.Println(<span class="string">&quot;job start&quot;</span>)</span><br><span class="line">	<span class="keyword">go</span> worker(ctx)</span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">	cancel()</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">&quot;work down&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">			fmt.Println(<span class="string">&quot;working&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/18/redis-aof-rdb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/18/redis-aof-rdb/" class="post-title-link" itemprop="url">Redis持久化实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-09-18 16:33:06 / 修改时间：20:15:00" itemprop="dateCreated datePublished" datetime="2023-09-18T16:33:06+08:00">2023-09-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%AB%E8%82%A1%E6%96%87/" itemprop="url" rel="index"><span itemprop="name">八股文</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/18/redis-aof-rdb/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/18/redis-aof-rdb/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>学习Redis的记录，参考自<a target="_blank" rel="noopener" href="https://xiaolincoding.com/redis/storage/aof.html#aof-%E6%97%A5%E5%BF%97">小林coding</a></p>
<h2 id="AOF日志"><a href="#AOF日志" class="headerlink" title="AOF日志"></a>AOF日志</h2><p>AOF日志简单来讲，就是把所有写操作Redis内容全部在执行后马上追加的AOF日志里。如果下次Redis重新启动，想要恢复，只需要按顺序执行它就能恢复整个记录。</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/6f0ab40396b7fc2c15e6f4487d3a0ad7.png" alt="AOF日志流程"></p>
<p>Redis默认情况下是不开启AOF日志的，需要修改<code>redis.conf</code>配置文件的参数修改</p>
<p>AOF日志是普通的文本文件，但是它通过一种自己的规则来记录的</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/337021a153944fd0f964ca834e34d0f2.png" alt="AOF日志内容"></p>
<h3 id="为什么redis要执行命令后写日志？"><a href="#为什么redis要执行命令后写日志？" class="headerlink" title="为什么redis要执行命令后写日志？"></a>为什么redis要执行命令后写日志？</h3><ol>
<li>避免额外的检查开销，如果执行的语句有问题，那么也会被写到AOF中。</li>
<li>不会阻塞当前写操作命令的执行</li>
</ol>
<h3 id="这样做有什么风险吗？"><a href="#这样做有什么风险吗？" class="headerlink" title="这样做有什么风险吗？"></a>这样做有什么风险吗？</h3><ol>
<li>因为执行命令和日志记录是分开进行的，如果执行了命令，在写日志的时候宕机，就会导致数据丢失了</li>
<li>虽然AOF在执行命令后进行追加，不会阻塞当前的命令，但会阻塞之后命令， 因为写日志也是主线程实现的。</li>
</ol>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/28afd536c57a46447ddab0a2062abe84.png" alt="AOF日志写盘时机"><br>‘<br>如果I&#x2F;O硬盘的压力过大，导致写入阻塞，那么AOF写入阻塞，进而导致整个redis阻塞，所以AOF的写回策略也就比较重要了</p>
<h2 id="AOF写回策略"><a href="#AOF写回策略" class="headerlink" title="AOF写回策略"></a>AOF写回策略</h2><p>Redis 写入AOF日志的流程如下</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/4eeef4dd1bedd2ffe0b84d4eaa0dbdea.png" alt="AOF日志写入"></p>
<p>跟Redis类似，也是增加一个缓冲区。然后设置一个参数，来保证刷盘速率</p>
<p>在<code>redis.conf</code>配置文件中的<code>appendfsync</code>配置项中可以有一下三个参数可选</p>
<ul>
<li>Always 每次执行完命令都会将AOF日志写入到数据中</li>
<li>EverySec 先将命令写入到<code>page cache</code>内核缓冲区，每秒执行依次</li>
<li>No 不由Redis控制，写回硬盘的时机，转交给操作系统控制写回的时机，先将AOF文件的内核缓冲区，再由操作系统决定何时将缓冲区内容写回硬盘</li>
</ul>
<h3 id="各个策略的特点"><a href="#各个策略的特点" class="headerlink" title="各个策略的特点"></a>各个策略的特点</h3><p>以上三种策略都无法完美解决主进程阻塞和减少数据丢失的问题，这就是鱼与熊掌不可兼得。性能和安全无法都顾全</p>
<ul>
<li>Always 策略的话，可以最大程度保证数据不丢失，但是由于它每执行一条写操作命令就同步将 AOF 内容写回硬盘，所以是不可避免会影响主进程的性能；</li>
<li>No 策略的话，是交由操作系统来决定何时将 AOF 日志内容写回硬盘，相比于 Always 策略性能较好，但是操作系统写回硬盘的时机是不可预知的，如果 AOF 日志内容没有写回硬盘，一旦服务器宕机，就会丢失不定数量的数据。</li>
<li>Everysec 策略的话，是折中的一种方式，避免了 Always 策略的性能开销，也比 No 策略更能避免数据丢失，当然如果上一秒的写操作命令日志没有写回到硬盘，发生了宕机，这一秒内的数据自然也会丢失。</li>
</ul>
<p>一般需要根据业务场景进行自己的选择</p>
<ul>
<li>高性能 no</li>
<li>高安全 always</li>
<li>折中 everysec</li>
</ul>
<h3 id="如何实现这三个策略"><a href="#如何实现这三个策略" class="headerlink" title="如何实现这三个策略"></a>如何实现这三个策略</h3><p>实际就是调用刷盘函数的时机</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/f64829ffc2e9e006b090f9aae51035ee.png" alt="AOF刷盘流程"></p>
<p>通过控制sync() 操作系统内核进行刷盘</p>
<h2 id="AOF-重写机制"><a href="#AOF-重写机制" class="headerlink" title="AOF 重写机制"></a>AOF 重写机制</h2><p>AOF是追加日志，如果不断的追加，只会让文件变得越来越冗余。所以提出AOF重写机制。</p>
<h3 id="机制怎实现减小文档大小？"><a href="#机制怎实现减小文档大小？" class="headerlink" title="机制怎实现减小文档大小？"></a>机制怎实现减小文档大小？</h3><p><img src="https://cdn.xiaolincoding.com//mysql/other/723d6c580c05400b3841bc69566dd61b.png" alt="AOF重写机制"></p>
<p>当使用重写机制时，就会读取最新的键值对。然后用新的AOF文件记录。按照这样的思路，对重写文件进行缩小，就能生成一个更小的AOF文件去覆盖旧的文件。</p>
<h4 id="为什么不直接复用文件？"><a href="#为什么不直接复用文件？" class="headerlink" title="为什么不直接复用文件？"></a>为什么不直接复用文件？</h4><p>如果出现宕机，那么AOF文件就被污染了， 所以要新建一个文件</p>
<h3 id="AOF后台重写"><a href="#AOF后台重写" class="headerlink" title="AOF后台重写"></a>AOF后台重写</h3><p>Redis得重写AOF过程是由后台子进程<code>bgrewriteof</code>完成的</p>
<h4 id="AOF后台重写有什么好处？"><a href="#AOF后台重写有什么好处？" class="headerlink" title="AOF后台重写有什么好处？"></a>AOF后台重写有什么好处？</h4><ul>
<li>子进程重写，不影响主进程的业务</li>
<li>子进程拿到的是主进程AOF日志的共享内存，如果出现修改内存数据，操作系统会自动触发写时复制，两者的数据副本就独立了</li>
</ul>
<h4 id="子进程如何获得一样的数据副本？"><a href="#子进程如何获得一样的数据副本？" class="headerlink" title="子进程如何获得一样的数据副本？"></a>子进程如何获得一样的数据副本？</h4><p>主进程进行<code>fork</code>可以为子进程复制一个页表，两者都指向一个物理内存。</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/5a1f2a90b5f3821c19bea3b7a5f27fa1.png" alt="fork复制页表"></p>
<p>这样子进程就共享了父进程的物理内存。这样就可以节约物理内存的资源，页表对应的页表项的属性会标记该物理内存的权限为只读。</p>
<p>如果主进程向这内存里发起写操作，CPU会触发写保护中断，然后操作系统就会把物理内存的值进行复制，最后才会对内存进行写操作。这个过程称为写时复制</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/d4cfac545377b54dd035c775603b4936.png" alt="写时复制"></p>
<h4 id="为什么用fork创建子进程，只复制页表？"><a href="#为什么用fork创建子进程，只复制页表？" class="headerlink" title="为什么用fork创建子进程，只复制页表？"></a>为什么用fork创建子进程，只复制页表？</h4><p>因为页表相对于实际的物理内存要更小，这样更小的可能导致父进程因为无法操作内存发生阻塞。</p>
<h4 id="后台重写时发生阻塞的时机？"><a href="#后台重写时发生阻塞的时机？" class="headerlink" title="后台重写时发生阻塞的时机？"></a>后台重写时发生阻塞的时机？</h4><ul>
<li>fork子进程，页表过大，可能会发生阻塞</li>
<li>在重写AOF的过程中，主进程修改了内存也会导致阻塞，因为这时会发生写时复制</li>
</ul>
<p>需要注意的如果主进程修改的是Key-Value，就会发生写时复制，但是只会复制主进程修改的物理内存数据，没修改的物理内存还是与子进程共享的</p>
<p>如果主进程修改了key-value，会导致主子进程的内存数据不一致，这时要怎么解决呢。</p>
<p>Redis设置了一个AOF重写缓冲区，在创建<code>bgwriteaof</code>子进程时，会开始使用</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0ODI3Njc0,size_16,color_FFFFFF,t_70-20230309231944807.png" alt="AOF内存一致性"></p>
<p>在重写 AOF 期间，当 Redis 执行完一个写命令之后，它会同时将这个写命令写入到 「AOF 缓冲区」和 「AOF 重写缓冲区」。</p>
<p>也就是说，在主进程在此期间要同时执行三个动作</p>
<ul>
<li>操作指令</li>
<li>追加命令 AOF缓存区</li>
<li>追加命令 AOF重写缓存区</li>
</ul>
<p>等子进程完成AOF重写任务后，会向主进程发送一条信号。主进程收到信号后，会调用一个信号处理函数做如下两个内容</p>
<ul>
<li>将AOF重写缓存区的数据追加到新的AOF文件中</li>
<li>覆盖旧的AOF文件</li>
</ul>
<p>执行完成后，主进程就可以继续像往常一样处理命令了</p>
<p>在整个 AOF 后台重写过程中，除了fork、发生写时复制会对主进程造成阻塞，还有信号处理函数执行时也会对主进程造成阻塞，在其他时候，AOF 后台重写都不会阻塞主进程。</p>
<h2 id="RDB-快照"><a href="#RDB-快照" class="headerlink" title="RDB 快照"></a>RDB 快照</h2><h3 id="什么是RDB快照？"><a href="#什么是RDB快照？" class="headerlink" title="什么是RDB快照？"></a>什么是RDB快照？</h3><p>快照即记录一瞬间的东西，RDB快照就是把当前Redis中的数据都存储起来，恢复起来也更快</p>
<h3 id="快照怎么用？"><a href="#快照怎么用？" class="headerlink" title="快照怎么用？"></a>快照怎么用？</h3><p>Redis 提供两个命令去执行快照读</p>
<ul>
<li><code>save</code> 在主线程中创建快照</li>
<li><code>bgsave</code> 创建子进程生成RDB，可以防止阻塞主线程</li>
</ul>
<p>当然还可以通过修改配置文件的选项来实现每隔一段时间，自动执行一次的bgsave命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>

<p>即为每多少秒至少修改n次会触发快照，</p>
<p>每 900秒内 修改1次会触发快照</p>
<p>注意是Redis是全量快照，每一次执行都会把内存中所有的数据都加入到硬盘中去。所以这里又涉及到了数据安全性和性能的抉择了</p>
<h3 id="执行快照时，数据能被修改吗？"><a href="#执行快照时，数据能被修改吗？" class="headerlink" title="执行快照时，数据能被修改吗？"></a>执行快照时，数据能被修改吗？</h3><p>如果是<code>save</code>指令，那么执行快照时，会出现主进程阻塞想修改也没法修改。如果时<code>bgsave</code>命令的话，那么就创建子进程fork页表，修改时会触发写时复制。写时复制也只是修改了修改的一部分。<br>比如说，bgsave进程正在执行的时候，有一个key-val值在主进程被改了，那么这个时候会触发写时复制，系统会把物理内存相关部分的数据在拷贝一份，然后将页表指向那个位置。之后子进程就是原本的值，主进程也是主进程的值</p>
<h4 id="修改的数据能被快照记录下来吗？"><a href="#修改的数据能被快照记录下来吗？" class="headerlink" title="修改的数据能被快照记录下来吗？"></a>修改的数据能被快照记录下来吗？</h4><p>不能，只能等到下一次快照</p>
<h2 id="RDB-和AOF合体"><a href="#RDB-和AOF合体" class="headerlink" title="RDB 和AOF合体"></a>RDB 和AOF合体</h2><p>redis 可以通过rdb和aof结合来让redis的恢复速度更快。</p>
<p>通过修改<code>aof-use-rdb-preamble</code>为<code>yes</code>即可以持久化。<br>这样的话即解决了频繁RDB导致主进程阻塞，和AOF日志过的问题。<br>在下次加载redis时，会先加载RDB，然后执行aof。恢复数据</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/17/redis-data-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yxh">
      <meta itemprop="description" content="鼠鼠我呀要努力啦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鼠鼠的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/17/redis-data-structure/" class="post-title-link" itemprop="url">Redis数据结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-09-17 16:49:33 / 修改时间：22:02:26" itemprop="dateCreated datePublished" datetime="2023-09-17T16:49:33+08:00">2023-09-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%AB%E8%82%A1%E6%96%87/" itemprop="url" rel="index"><span itemprop="name">八股文</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/17/redis-data-structure/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/17/redis-data-structure/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Redis-数据类型"><a href="#Redis-数据类型" class="headerlink" title="Redis 数据类型"></a>Redis 数据类型</h2><ul>
<li>String  字符串 </li>
<li>List  列表</li>
<li>Set   集合</li>
<li>Zset  有序集合</li>
<li>Hash  哈希</li>
<li>BitMap</li>
<li>HyperLogLog</li>
<li>GEO</li>
<li>Stream</li>
</ul>
<p>结合一张图可以大致了解使用情况</p>
<p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/redis/%E5%85%AB%E8%82%A1%E6%96%87/key.png" alt="Redis 数据类型"></p>
<h2 id="各个数据类型的场景"><a href="#各个数据类型的场景" class="headerlink" title="各个数据类型的场景"></a>各个数据类型的场景</h2><table>
<thead>
<tr>
<th>结构体类型</th>
<th>结构体存储的值</th>
<th>结构体的读写能力</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>String</td>
<td>字符串、整数、浮点数</td>
<td>对整个字符串或字符串的一部分进行操作，对数进行自增或自减的操作</td>
<td>缓存对象、常规计数、分布式锁、共享session信息</td>
</tr>
<tr>
<td>List</td>
<td>一个链表，每个节点都包含一个字符串</td>
<td>对链表的两端进行push和pop操作，根据值查找和删除元素</td>
<td>消息队列（需要自己生成全局ID，不能以消费组的形式消费数据）</td>
</tr>
<tr>
<td>Hash</td>
<td>包含键值对的无序散列表</td>
<td>添加、获取、删除操作</td>
<td>缓存对象、购物车等</td>
</tr>
<tr>
<td>Set</td>
<td>包含字符串的无序集合</td>
<td>字符串的集合，包含添加、删除、获取。包含计算交集、并集、差集</td>
<td>聚合计算场景如：点赞、共同关注、抽奖活动</td>
</tr>
<tr>
<td>Zset</td>
<td>和散列一样，用于存储键值对</td>
<td>字符串成员与浮点分数的有序映射，元素排列由分数的大小决定，包含方法有添加、获取、删除单个元素及以分值范围或成员来获取元素</td>
<td>排行榜、电话、姓名排序</td>
</tr>
<tr>
<td>BitMap</td>
<td>一串连续的二进制字节数组</td>
<td>对每个bit都利用起来，设置值、获取值、指定范围的值</td>
<td>二值统计场景如 签到打卡</td>
</tr>
<tr>
<td>HyperLogLog</td>
<td>提供元素</td>
<td>添加、返回计算估值、合并，根据元素概率提供不精确的去重计数</td>
<td>UV计数、WordCount等</td>
</tr>
<tr>
<td>GEO</td>
<td>存储地理位置信息，实现位置计算</td>
<td>存储、返回位置、返回两点位置、根据位置查询范围</td>
<td>滴滴打车</td>
</tr>
<tr>
<td>Stream</td>
<td>消息流和消费者组。消息流是一个有序的消息集合，每个消息都有一个唯一的 ID。消费者组包含多个消费者，它们可以协作地消费消息流中的消息，并通过应答来跟踪处理进度。</td>
<td>命令比较多，之后总结</td>
<td>消息队列</td>
</tr>
</tbody></table>
<h2 id="五种常见的数据类型怎么底层实现？"><a href="#五种常见的数据类型怎么底层实现？" class="headerlink" title="五种常见的数据类型怎么底层实现？"></a>五种常见的数据类型怎么底层实现？</h2><h3 id="string-实现"><a href="#string-实现" class="headerlink" title="string 实现"></a>string 实现</h3><p>String底层类型是动态字符串SDS。其特点</p>
<ul>
<li>不仅可以保存字符还能保存二进制</li>
<li>SDS 获取字符串长度的时间复杂度为O(1),存在一个len属性</li>
<li>Redis 的SDS API是安全二点，拼接字符串不会造成缓冲区溢出，会自动进行扩容</li>
</ul>
<h3 id="List-内部实现"><a href="#List-内部实现" class="headerlink" title="List 内部实现"></a>List 内部实现</h3><p>List的底层是双向链表和压缩列表实现</p>
<ul>
<li>当链表数量小于512个，列表元素的值都小于64字节，redis会使用压缩列表作为List类型的底层数据结构</li>
<li>当列表不满足上面要求时，会使用双向链表作为List的底层数据结构</li>
</ul>
<p>3.2版本之后统一使用了quickList</p>
<h3 id="Hash-内部实现"><a href="#Hash-内部实现" class="headerlink" title="Hash 内部实现"></a>Hash 内部实现</h3><p>Hash的底层由压缩列表或哈希表实现</p>
<ul>
<li>如果哈希类型元素小于512个，所有字节都小于64KB，Redis会使用压缩列表作为存储方法</li>
<li>否则会使用hash表实现</li>
</ul>
<p>7.0版本之后统一使用listquick实现</p>
<h3 id="Set-类型内部实现"><a href="#Set-类型内部实现" class="headerlink" title="Set 类型内部实现"></a>Set 类型内部实现</h3><p>Set 类型是由hash表或整数集合实现</p>
<ul>
<li>如果set中都是整数且数量小于512则使用整数集合</li>
<li>否则使用hash表实现</li>
</ul>
<h3 id="Zset-类型内部实现"><a href="#Zset-类型内部实现" class="headerlink" title="Zset 类型内部实现"></a>Zset 类型内部实现</h3><p>Zset 内部由压缩列表和跳表实现</p>
<ul>
<li>元素小于128个且每个小于64字节使用压缩列表</li>
<li>否则使用跳表实现</li>
</ul>
<p>7.0版本后由listpack实现</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yxh"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">yxh</p>
  <div class="site-description" itemprop="description">鼠鼠我呀要努力啦</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yxh</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'aXkNqUKnMUGvI43o5733DET4-MdYXbMMI',
      appKey     : '9cXqMO3WNRAbkxYpxyHQILyb',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
